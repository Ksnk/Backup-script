    Немного лирики

Как-то попался на глаза скрипт для создания бякапа базы данных. Вспомнилось, что заказчик давно плакался,
что моей админке не хватает кнопочки "сохрани базу/восстанови базу", а я ему втирал, что это ответственное
и сложное дело (так оно, в принципе и есть) и "вот я для этого поставил SypexDumper - смотри как харашо"
(и это дествительно непллохо). Однако осадочек остался...

Привлекательного в том скрипте, как оказалось, было только то, что он занимал 100 строк, однако он спровоцировал
меня на попытку его использовать и написать что-то свое.

Для информации - я знаю про SypexDumper и некоторые решения оттуда использовал. Также я знаю про phpMyAdmin и mysqldumper

Польза самодельного скрипта в том, что он занимает 300 строк слегка откоментаренного текста  и написан мной, что для
любого девелопера представляет несомненную и непреходящую пользу ;)
Понимает файлы от phpMyAdmin и от SypexDumper, работает с gz. Умеен делать дампы и отгружать их в броузер "на лету",без
использования файлов.
Также при создании бякапа он не лочит базу, а проверяет
время модификации таблиц. Если таблицы изменились за время построения бякапа - бякап пересоздается. Такое решение сразу
ограничивает нам применение скрипта на "не очень нагруженные" сайты + никуда не делось пока (и не хочу убирать)
ограничение в 30 секунд на время выполнения скрипта (user_ignore_abort). Зато база не лочится и сайт не проседает...

Из ограничений выходит предназначение: Скрипт предназначен для восстановления после аварии при наличии бякапа и
при отсутствии штатных средств восстановления + для создания бякапа "по требованию". Размер базы имеет значение
(не очень большие - не более 30 секунд на бякап -восстановление).
Он представляет собой единственный файл, его легче доставить на сайт, чем более сложную утилиту.

Как им управлять

При вызове скрипта без параметров будет предоставлен довольно лаконичый выбор с опциями
-- загрузить файл с sql дампом и восстановить из него
-- восстановить базу из списка обнаруженных sql файлов
-- восстановить базу из брошенного в textarea sql дампа.
-- сделать бякап и поместить его в файл
-- сделать бякап и отгрузить в броузер клиента.

имя файла с которым работаем передается через параметр file
в начальном случае, выбор файлов бякапа будет

Все управление идет через адресную строку. Передаются параметры в URI  стиле. Список параметров

// настройка на базу
        'host'=>'localhost', // хост
        'user'=>'root', // имя-парол
        'password'=>'',
        'base'=>'tmp',  // имя базы данных
//  backup-only параметры
        'include'=>'*', // маска в DOS стиле со * и ? . backup-only
        'exclude'=>'',  // маска в DOS стиле со * и ? . backup-only
        'dir'=>'./',    // путь со слешем до каталога хранения бякапов . backup-only
        'compress'=>9, // уровень компрессии для gz  . backup-only
//  both-way параметры
        'code'=>'utf8', // set NAMES 'code'
//  restore-only параметры
        'restore'=>'',  // имя файла SQL-дампа для чтения


Примеры:

   backup.php?restore=tmp.sql&code=cp1251
   backup.php?include=darts_*,SESSION&exclude=*_tmp


Думал насчет выложить на github, но потом подумал, что скрипт нужно допиливать для вставки в админку и в виде плагина
он еще менее будет  интересен народу.

