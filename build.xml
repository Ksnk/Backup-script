<?xml version="1.0" encoding="UTF-8"?>
<!-- phing bild file -->
<project name="darts" default="build.allinone">
    <taskdef name="preprocess" classname="phing.tasks.ext.preprocessor.preprocessTask" />

    <!-- Sets the DSTAMP, TSTAMP and TODAY properties -->
    <tstamp/>
    <property file="../env.prop" />

    <!-- настройка проекта на место -->
    <property name="sitedst" value="z:/home/localhost/www/rights"/>

    <!-- so let's go -->
    <target name="property">
        <echo file="svn.prop" append="false"><![CDATA[
version=RIGHTS - full power realisation, sergekoriakin@gmail.com, Ver : 0.1
license=License GNU/LGPL - Serge Koriakin - Jule 2010-2012
env_common=${common}
svn_revision=$WCREV$
svn_modified=$WCDATE$
svn_url=$WCURL$
lasttarget=${target}
]]>        </echo>
        <exec executable="SubWCRev" dir=".">
            <arg file="." />
            <arg file="svn.prop" />
            <arg file="svn.prop" />
            <arg value="-f" />
        </exec>
    </target>

    <target name="build.allinone" depends="property" description="build allinone part">
        <property file="svn.prop" />

        <preprocess  config="config.xml" force='force'>
            <param name="dst" value="build/allinone"/>
            <param file="svn.prop"/>

            <param name="executor" default="URI_executor"/>

                <files>
                    <echo>
                    <![CDATA[<%  $buildtime=date('ymdHi'); point_start('hat');echo
            '----------------------------------------------------------------------------
            $Id: '.$version.'
             Rev: '.$svn_revision.', Modified: '.$svn_modified.'
             SVN: '.$svn_url.'$
            ----------------------------------------------------------------------------
            '.$license.'
            ----------------------------------------------------------------------------'; point_finish() ;%>]]>
                    </echo>

                    <file>src/$executor.php</file>

                	<file dstdir="$dst"  dir="src">backup.php</file>
            	</files>
        </preprocess>
    </target>

    <target name="build.plugin" depends="property" description="build plugin part">
        <property file="svn.prop" />

        <preprocess  config="config.xml" force='force'>
            <param name="dst" value="build/cms-plugin"/>
            <param name="executor" value="empty_executor"/>
            <param file="svn.prop"/>
        </preprocess>
    </target>

    <target name="build.debug.allinone" depends="property" description="build allinone part to check at server">
        <property file="svn.prop" />

        <preprocess  config="config.xml" force='force'>
            <param name="dst" value="${sitedst}"/>
            <param name="target" value="allinone"/>
            <param file="svn.prop"/>
        </preprocess>
    </target>

    <target name="build.all" depends="property,build.allinone,build.plugin" description="build all"/>

    <target name='test'>
    <exec
            command="git describe --tags"
            checkreturn="true"
            logoutput="true"
    />
    </target>
</project>
